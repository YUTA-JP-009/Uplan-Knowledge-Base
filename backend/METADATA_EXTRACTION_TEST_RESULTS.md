# メタデータ抽出機能 テスト結果

## テスト日時
2025-12-06

## テスト対象
フォルダパスから以下の情報を自動抽出する機能
- 作成日（提出日）
- 提出年・月
- 取引先名
- 物件名

## テストケース

### 入力パス
```
001_Ｕ'plan_全社/01.構造設計/01.木造（在来軸組）/□さ行/T125 三栄建築設計（計算書・構造図ダブルチェック必要）/2025004_蕨市錦町002②1号棟/09.成果物/20250312_蕨市錦町002②1号棟_【補正】 構造設計図書
```

### 抽出結果

| 項目 | 抽出値 | 期待値 | 結果 |
|------|--------|--------|------|
| 作成日 | 2025-03-12 | 2025-03-12 | ✅ OK |
| 提出年 | 2025 | 2025 | ✅ OK |
| 提出月 | 3 | 3 | ✅ OK |
| 取引先名 | 三栄建築設計 | 三栄建築設計 | ✅ OK |
| 物件名 | 蕨市錦町002②1号棟 | 蕨市錦町002②1号棟 | ✅ OK |

### 総合結果
**✅ すべてのテストが成功しました**

## 実装詳細

### 抽出ロジック

#### 1. 取引先名の抽出
- **パターン**: `T125 三栄建築設計（計算書・構造図ダブルチェック必要）`
- **正規表現**: `^[T]?\d+\s+(.+?)(?:（.+?）)?$`
- **抽出結果**: 「三栄建築設計」（括弧内は除外）

#### 2. 物件名の抽出
- **パターン**: `2025004_蕨市錦町002②1号棟`
- **正規表現**: `^(\d{7,})_(.+)$`（7桁以上の数字で始まるもの）
- **抽出結果**: 「蕨市錦町002②1号棟」

#### 3. 作成日の抽出
- **パターン**: `20250312_蕨市錦町002②1号棟_【補正】 構造設計図書`
- **正規表現**: `^(\d{4})(\d{2})(\d{2})_`
- **抽出結果**: 「2025-03-12」（YYYY-MM-DD形式）
- **検証**: 日付の妥当性チェック済み

## Firestoreへの保存形式

```json
{
  "submission_date": "2025-03-12",
  "submission_year": 2025,
  "submission_month": 3,
  "client_name": "三栄建築設計",
  "project_name": "蕨市錦町002②1号棟",
  "folder_full_path": "001_Ｕ'plan_全社/01.構造設計/01.木造（在来軸組）/□さ行/T125 三栄建築設計（計算書・構造図ダブルチェック必要）/2025004_蕨市錦町002②1号棟/09.成果物/20250312_蕨市錦町002②1号棟_【補正】 構造設計図書",
  "onedrive_url": "https://..."
}
```

## フロントエンド活用例

### 表示イメージ
```
物件名: 蕨市錦町002②1号棟
作成日: 2025年3月12日
取引先: 三栄建築設計
リンク: [OneDriveで開く] → (クリックでフォルダに遷移)
```

### 検索・フィルタリング機能
- **年月でフィルタリング**: `submission_year: 2025`, `submission_month: 3`
- **取引先で検索**: `client_name: "三栄建築設計"`
- **物件名でテキスト検索**: `project_name`でインクリメンタルサーチ

## エッジケースのテスト

### テストケース2: 日付なしのフォルダ
```
□さ行/T125 三栄建築設計（計算書・構造図ダブルチェック必要）/2025004_蕨市錦町002②1号棟/09.成果物/構造設計図書
```

**結果**:
- 作成日: 不明（null）
- 取引先名: 三栄建築設計 ✅
- 物件名: 蕨市錦町002②1号棟 ✅

→ 日付がない場合も、取引先名と物件名は正しく抽出される

## 実装ファイル
- **メイン実装**: `batch_processor_v3.py` (40-94行目: `extract_project_metadata()`)
- **テストスクリプト**: `test_metadata_extraction.py`
- **統合テスト**: `test_full_path_extraction.py`

## 次のステップ
1. ✅ メタデータ抽出機能の実装完了
2. ✅ 単体テスト完了
3. ⏭️ 実際のバッチ処理での動作確認（OneDrive連携テスト）
4. ⏭️ Firestoreへのデータ保存確認
5. ⏭️ フロントエンド開発（Next.js検索UI）
